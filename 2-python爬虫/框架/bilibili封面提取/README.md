### BiliBili视频封面提取器

​	这几天在b站追炮姐，然后看到一张不错的封面图去网上找了一个提取器，结果告诉我要关注微信公众号，作为程序猿那必不可能就这么屈服了，后来想想其实这东西蛮容易的。就是使用requests发几个请求的事情，所以想了想还是自己写一个比较实在。

**功能**

- 获取视频封面并保存
  - 图片直接保存在本地
  - 提取出封面的图片url地址，并显示在控制台
- 根据关键字在bilibili进行检索，并根据输入批量获取封面【多线程】并下载到本地指定路径

**环境**

1. Windows10
2. python3.7

**使用方法**

​	使用方法非常简单：

1. 在config.yaml文件中配置图片保存路径【绝对路径】以及最大线程数。
2. 然后直接运行`spider.py`文件即可。接着需要输入爬取类型，如果是关键字爬取就输入关键字，并输入要爬取的页数，如果是单个爬取则只需要提供相应的BV号或AV号，然后选择是要url地址还是保存在本地即可。保存在本地的话，图片会被保存在上述配置的路径下，如果是显示链接的话控制台上会给出图片地址的。

**技术栈**

1. json
2. parsel
3. re
4. os
5. requests
6. yaml
7. threading

**叨叨**

- 2021.6.18

  ​	项目中有两个我自己用来测试的图片【都是炮姐的~~~】，具体的图片来源就是图片名称所对应的视频，所以要想看看原视频的话可以在b站直接搜索图片名称即可。

- 2021.8.5

  ​	本次更新主要添加了多线程批量爬取的功能，同时添加了一个词表用来解决上次并没有完全解决的那个bug【之前那个因为视频名称中包含特殊字符而无法爬取的bug已被彻底修复】。经测试可以在不更换IP的情况下实现1000个视频封面的获取。还有就是添加了配置文件方便使用者配置线程数，以及图片保存路径。

  ​	同时由于这次更新获取封面的方式和上次单个封面的获取方式完全不同【直接请求搜索数据接口】，所以效率更高，但同时也面临了封ip的问题。具体解决方法肯定就是添加IP代理池，但是由于还没有找到可靠的Ip源【并不想找网上的商务Ip源那种，那种ip源一是得花钱，二是无法体验自己搭建ip池的快乐，所以在我找到可靠地ip源后会将目前现有库存里的所有多线程爬虫都添加一个ip池】

  

**更新日志**

- 2021.6.18

  **更新基础功能，同时附带两张b站视频壁纸，并发现一个bug**

- 2021.6.23

  **修复上述bug——无法提取视频名字中带有“/”的视频封面**

  ​	具体方案：将视频名称中的“/”符号替换成“-”符号，经测试，依旧可以通过获取到的图片的名称在bilibili检索到原视频。并附带新的两张视频封面。
  
- 2021.8.5

  **彻底修复路径问题导致的无法爬取bug**

  ​	具体方案：建立屏蔽词表，将相应的非法词替换成合法词【其实有个更简单的方法：直接在获取title之后对title字符串使用replace函数或re.sub即可。但是出于符号的准确性，所以我自己维护了一个屏蔽词表，如果想要加入其它屏蔽词，在词表中按行加入即可，具体格式：屏蔽词+空格+替换词】

  **添加批量爬取的功能，无ip池时最大爬取量1k个视频**

  ​	具体方案：请求哔哩哔哩的search接口`https://api.bilibili.com/x/web-interface/search/all/v2`获取json数据，并从中直接获取封面。

  ​	后续修改方案：由于上面这种方案请求速度过快，会导致ip被封的情况，所以在后面会加入另一种爬取方案——请求接口`https://search.bilibili.com/all`直接获取html中获取封面地址。

  **添加配置文件方便使用者配置最大线程数以及图片保存路径**

  **保存下来的图片的名称格式更改为：视频名称___BV号**