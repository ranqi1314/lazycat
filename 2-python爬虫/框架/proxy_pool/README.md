### 本项目代理池使用指南

​	首先在这里要再次鸣谢大佬们所维护的这个[项目](https://github.com/jhao104/proxy_pool)，在这个文档里面我会说明一下我对大佬们写出的接口进行的封装，以及如何在我这个项目下面使用这个代理池，同时我也会将我封装的代码在这里单发一份，以方便大家直接使用。后续如果有机会的话，我会在博客更新一个如果使用上述项目以及腾讯云搭建自己的代理服务器的博文（主要是因为github发图太难了），欢迎大家star这个项目以方便后面查阅。

​	首先要想使用这个代码的需要先克隆大佬们的那个项目，并在自己的电脑或服务器上跑起来，具体的方法可以看那个项目的README，搭建起来真的不复杂，能有个5分钟就好了。但是要注意跑那个项目需要电脑或服务器上安装python，pip，redis等环境。而这里我就仅对自己封装的部分进行说明了。

1. **config.yaml文件**

   ​	主要的作用就是配置接口的访问ip以及端口的，如果是想跑在自己的电脑上的话，就是用默认配置就好啦，host是127.0.0.1，port是5010，这里的接口需要与大佬项目中`setting.py`中的PORT一致。**同时还需要配置is_proxy属性，其主要作用在于是否使用代理，如果不使用代理则会自动使用requests原生请求方式，如果使用代理则需要clone并配置上述项目相应的host和port**。

   如果是想要跑在服务器上，那么host就不能是127.0.0.1了，而应该是你服务器的公网IP，而端口依旧得和`setting.py`文件中的PORT一致，然后在服务器上按照大佬们给出的方法分别启动`schedule`和`server`服务即可。这里可以把两个都直接放到后台运行即可。

   > 注意：schedule服务是用来获取代理的，而server服务进提供接口服务，所以说需要先启动schedule来获取代理，并行运行效果更佳因为代理是有时效性的嘛。

2. **Proxy_pool.py文件**

   ​	主要作用就是对大佬们提供的接口进行了封装以及一些扩展。提供了post和get两个不同的方法，并在参数中提供了cookie，headers，retry_count等参数方便调用。其中https这个参数的作用是用来筛选https代理的，如果开启那么代理返回的就都是https代理了，但这里建议不到万不得已不要开启，因为这个代理池都是从免费代理池中爬取的，所以包含大量的http代理，仅有小部分的https代理。如果开启这个模式首先会导致重筛选的问题【可能会影响速度或是卡住】，其次还有可能会导致仅有少量代理返回，从而使少数代理被频繁使用，从而被封。这样的话代理池的作用几乎就没有了。
   
   ​	使用上的话，如果是简单的爬虫，这个类里面的get_response方法以及post_response方法直接调用接口，其几乎可以直接代替requests库进行使用了。函数以及参数详情见表：
   
   |       方法/作用       |              返回值              |
   | :-------------------: | :------------------------------: |
   |  **get**/发送get请求  | response【与requests返回的相同】 |
   | **post**/发送post请求 | response【与requests返回的相同】 |
   
   |    参数     |                          类型/作用                           |                 默认值                  |
   | :---------: | :----------------------------------------------------------: | :-------------------------------------: |
   |     url     |                   **字符串类型**/链接地址                    |             无【需要填入】              |
   |   headers   |                   **字符串类型**/请求头部                    |             无【需要填入】              |
   |    https    |          **布尔类型**/置True时会进一步筛选https代理          |                  False                  |
   |   cookies   |              **字符串类型**/用来模拟已登录账号               |                空字符串                 |
   |    data     |        **字典类型**/post请求，用来模拟表单提交的数据         |          空字典，可选择不填入           |
   | retry_count | **number类型**/用来规定最大重试次数【超过最大请求次数则该代理会从数据库中删除】 |                    5                    |
   |  anonymity  | **布尔类型**/置True时会进一步筛选匿名代理【强烈建议不要与与https属性同时打开会大幅降低代理数量】 |                  False                  |
   |   timeout   |      **number类型**/用来规定超时重试时间【单位seconds】      |                   10                    |
   |  is_proxy   | **bool类型**/选择是否启用代理，置False则使用requests原生请求 | 该参数为内置参数，请在config.yaml中配置 |
   
3. **导入项目**

   ​	将上述两个文件放到根目录下，并用`from xxx import ProxyPool`引入项目即可，引入项目之后使用`proxy_pool=ProxyPool()`代码创建一个代理池对象，之后直接调用`get`和`post`方法即可，与requests库使用完全一致。

#### 更新日志

* 2022.1.4

  **Add**

  1. 添加is_proxy配置

* 2022.1.3

  更新第三版

  **Fix**

  1. 修复上一版匿名代理检测失败bug
  2. 修复上一版https代理筛选报错bug

* 2021.12.15

  更新第二版，修复了上一版的一些bug，加入匿名代理筛选，与超时相应选项，同时对函数名进行优化，实现与requests库无痛切换

* 2021.8.11

  更新第一版，完成基本封装，添加https代理筛选代码，同时将host配置和port配置提出到配置文件
